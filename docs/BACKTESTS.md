# Backtesting Engine

The backtesting module evaluates trading strategies on historical data using vectorized, pandas-based approach.

---

## Overview

The `Backtester` class takes in a DataFrame containing:

- price data (optional)
- a `returns` column
- a `signal` column generated by a strategy

It converts signals into raw positions, computes strategy returns, and produces performance metrics. 

---

## Class Definition

```python
Backtester(data: pd.DataFrame, signal_col: str= "signal")
```

### Parameters 
- **data (pd.DataFrame)**
    Must contain at least a `returns` column and a signal column generated by a strategy.

- **signal_col (str)**
    Name of the column containing trading signals. Defaults to `"signal"`. 

---

## Methods

### run()
Executes the backtest:

- shifts signals by one period to avoid lookahead bias
- computes positions
- computes strategy returns 
- stores the results in `self.results`

### total_return()
Computes the annualized Sharpe ratio using:

- mean excess return
- standard deviation of returns
- √252 annualization factor

### max_drawdown()
Computes the worst peak-to-trough decline in the cumulative equity curve. 

---

## Output DataFrame

After running `Backtester.run()` the results DataFrame contains: 

- **signal** - strategy-generated trading signals
- **position** - shifted signals (no lookahead bias)
- **returns** - underlying asset returns
- **strategy_returns** - position × returns
- **price** (optional, if included in input)

This DataFrame is stored internally as `self.results`.

--- 

## Example Usage

```python
signals = moving_average_crossovers(df["close"])
signals["returns"] = df["returns"]

bt = Backtester(signals)
results = bt.run()

print("Total Return:", bt.total_return())
print("Sharpe Ratio:", bt.sharpe_ratio())
print("Max Drawdown:", bt.max_drawdown())
```

## Role in the System

The backtesting engine sits **after the strategy layer** and provides the performance evaluation needed to compare strategies and validate ideas.

## Data Flow
processed data -> strategy -> Backtester -> performance metrics -> visualization